<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern CMS Platform</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com/3.3.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
    
    <style>
        /* Paleta de colores: Azul profesional (#2575fc) con acentos naranja (#ff6b6b) */
        .gradient-bg {
            /* Usando una variación de tus colores especificados */
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
        }
        .font-oswald { font-family: "Oswald", sans-serif; }
        .font-poppins { font-family: "Poppins", sans-serif; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        .btn-primary {
            /* Adaptado a #2575fc */
            background: linear-gradient(135deg, #3b82f6 0%, #2575fc 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2575fc 0%, #1d4ed8 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
        
        .btn-danger {
            /* Adaptado a #ff6b6b */
            background: linear-gradient(135deg, #ff6b6b 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }
        
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        .notification-enter-active {
            transition: all 0.3s ease-out;
        }
        
        .notification-leave-active {
            transition: all 0.3s ease-in;
        }
        
        .notification-enter-from {
            opacity: 0;
            transform: translateX(100%);
        }
        
        .notification-leave-to {
            opacity: 0;
            transform: translateX(100%);
        }
        
        .post-content {
            max-height: none; /* Removed fixed height for clarity in demo */
            overflow: visible;
        }

        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .slide-fade-enter-active {
            transition: all 0.3s ease-out;
        }
        
        .slide-fade-leave-active {
            transition: all 0.3s ease-in;
            position: absolute; /* Fixes list movement during removal */
            width: 100%;
        }
        
        .slide-fade-enter-from {
            opacity: 0;
            transform: translateY(-10px);
        }
        
        .slide-fade-leave-to {
            opacity: 0;
            transform: translateY(10px);
        }
        
        .loading-skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .search-highlight {
            /* Color de acento naranja */
            background-color: rgba(255, 107, 107, 0.4); 
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tag {
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        
        .tag:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }
        
        .post-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .post-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .post-card:hover::before {
            left: 100%;
        }
        
        .dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        .dark-mode .glass-card {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Floating Action Button (Only Scroll Top remains) */
        .floating-action-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 40;
        }

        .floating-action-btn:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
        }

        /* PROGRESS BAR REMOVED */
        
        .typewriter-text {
            overflow: hidden;
            border-right: 2px solid rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: rgba(255, 255, 255, 0.7) }
        }

        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
            
        }

        .neon-glow {
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5),
                        0 0 20px rgba(59, 130, 246, 0.3),
                        0 0 30px rgba(59, 130, 246, 0.1);
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 50;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 4px;
        }
        
        .autocomplete-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .autocomplete-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* New class for the integrated theme toggle */
        .theme-toggle-btn {
            background: none;
            color: #ffc107; /* Yellow/Orange color for sun/moon */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            outline: none;
            border: 2px solid transparent;
        }
        
        .theme-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
            border-color: rgba(255, 193, 7, 0.5);
        }

        /* Specific styles for the non-logged-in hero section */
        .hero-section {
            padding: 80px 0;
            text-align: center;
            background: rgba(255, 255, 255, 0.05); /* Lighter glass effect */
            border-radius: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(15px);
        }

        .hero-title {
            font-size: 3rem;
            line-height: 1.1;
            margin-bottom: 1rem;
        }
        
        @media (min-width: 1024px) {
            .hero-title {
                font-size: 4rem;
            }
        }
    </style>
</head>
<body :class="{'dark-mode': isDarkMode, 'gradient-bg': !isDarkMode}" class="min-h-screen font-poppins transition-colors duration-500">
    
    <div class="particles-container">
        <div v-for="i in 15" :key="i" class="particle" :style="{
            width: Math.random() * 10 + 5 + 'px',
            height: Math.random() * 10 + 5 + 'px',
            left: Math.random() * 100 + '%',
            animationDelay: Math.random() * 20 + 's',
            animationDuration: Math.random() * 10 + 15 + 's'
        }"></div>
    </div>

    <div id="app" class="container mx-auto px-4 py-8">
        <button
            v-if="showScrollTop"
            @click="scrollToTop"
            class="floating-action-btn transition-all duration-300 transform hover:scale-110"
            aria-label="Scroll to top"
        >
            <i class="fas fa-chevron-up"></i>
        </button>

        <div class="fixed top-4 right-20 z-50 space-y-2 max-w-sm w-full">
            <transition-group name="notification">
                <div
                    v-for="notification in notifications"
                    :key="notification.id"
                    :class="[
                        'p-4 rounded-lg shadow-lg backdrop-blur-lg border transform transition-all duration-300',
                        notification.type === 'success' ? 'bg-green-500/20 border-green-500/30 text-green-100' :
                        notification.type === 'error' ? 'bg-red-500/20 border-red-500/30 text-red-100' :
                        'bg-blue-500/20 border-blue-500/30 text-blue-100'
                    ]"
                    role="alert"
                >
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i :class="[
                                'text-lg',
                                notification.type === 'success' ? 'fas fa-check-circle' :
                                notification.type === 'error' ? 'fas fa-exclamation-circle' :
                                'fas fa-info-circle'
                            ]"></i>
                            <span class="font-medium">{{ notification.message }}</span>
                        </div>
                        <button @click="removeNotification(notification.id)" class="text-gray-300 hover:text-white transition-colors" aria-label="Close notification">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </transition-group>
        </div>

        <nav class="flex justify-between items-center mb-16">
            <div class="flex items-center space-x-4">
                <div class="text-white">
                    <h1 class="text-2xl md:text-3xl font-bold font-oswald gradient-text typewriter-text">MODERN CMS</h1>
                    <p class="text-sm text-gray-300 hidden md:block">Manage your digital content efficiently</p>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                
                <button
                    @click="toggleTheme"
                    class="theme-toggle-btn"
                    aria-label="Toggle theme"
                >
                    <i :class="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
                </button>

                <div v-if="user" class="relative hidden md:block" v-click-outside="() => showSuggestions = false">
                    <input
                        v-model="searchQuery"
                        @focus="showSuggestions = true"
                        type="text"
                        placeholder="Search posts..."
                        class="glass-input w-64 px-4 py-2 rounded-full text-white placeholder-gray-400 focus:outline-none"
                        aria-label="Search posts"
                    />
                    <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    
                    <transition name="fade">
                        <div v-if="showSuggestions && postSuggestions.length > 0" class="autocomplete-list glass-card rounded-xl shadow-2xl p-0">
                            <div 
                                v-for="post in postSuggestions" 
                                :key="post.id" 
                                @click="selectSuggestion(post)"
                                class="autocomplete-item text-white text-sm"
                            >
                                <i class="fas fa-file-alt mr-2 text-blue-400"></i>
                                <span v-html="highlight(post.title)"></span>
                                <span class="text-xs text-gray-400 ml-2">({{ post.status }})</span>
                            </div>
                        </div>
                    </transition>
                </div>

                <template v-if="user">
                    <div class="flex items-center space-x-3 text-white">
                        <div class="w-10 h-10 rounded-full overflow-hidden bg-gradient-to-br from-blue-400 to-purple-500 pulse-animation">
                            <div class="w-full h-full flex items-center justify-center">
                                <i class="fas fa-user text-white text-sm"></i>
                            </div>
                        </div>
                        <span class="font-medium hidden lg:block">{{ user.full_name }}</span>
                        <button @click="showCreatePost = true" class="btn-secondary text-white px-4 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 hidden sm:block">
                            <i class="fas fa-plus mr-2"></i>New Post
                        </button>
                        <button @click="logout" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </template>
                <template v-else>
                    <button @click="showLogin = true" class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </button>
                    <button @click="showRegister = true" class="btn-secondary text-white px-6 py-3 rounded-lg font-medium hidden sm:block">
                        <i class="fas fa-user-plus mr-2"></i>Sign Up
                    </button>
                </template>
            </div>
        </nav>

        <div v-if="user" class="md:hidden flex flex-col space-y-4 mb-6">
            <button @click="isMobileSearchVisible = !isMobileSearchVisible" class="glass-card text-white px-4 py-2 rounded-lg">
                <i class="fas fa-search mr-2"></i>{{ isMobileSearchVisible ? 'Close Search' : 'Search Posts' }}
            </button>
            <transition name="slide-fade">
                <div v-if="isMobileSearchVisible" class="relative" v-click-outside="() => showSuggestions = false">
                    <input
                        v-model="searchQuery"
                        @focus="showSuggestions = true"
                        type="text"
                        placeholder="Search posts..."
                        class="glass-input w-full px-4 py-3 rounded-xl text-white placeholder-gray-400 focus:outline-none"
                        aria-label="Search posts"
                    />
                    <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    
                    <transition name="fade">
                        <div v-if="showSuggestions && postSuggestions.length > 0" class="autocomplete-list glass-card rounded-xl shadow-2xl p-0">
                            <div 
                                v-for="post in postSuggestions" 
                                :key="post.id" 
                                @click="selectSuggestion(post)"
                                class="autocomplete-item text-white text-sm"
                            >
                                <i class="fas fa-file-alt mr-2 text-blue-400"></i>
                                <span v-html="highlight(post.title)"></span>
                                <span class="text-xs text-gray-400 ml-2">({{ post.status }})</span>
                            </div>
                        </div>
                    </transition>
                </div>
            </transition>
        </div>

        <transition name="fade">
            <div v-if="showLogin" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                <div class="glass-card rounded-3xl max-w-md w-full mx-auto">
                    <div class="p-8 pb-6">
                        <div class="flex justify-between items-center mb-2">
                            <h2 class="text-2xl font-bold font-oswald text-white">Welcome Back</h2>
                            <button @click="closeLogin" class="text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-white/10">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <p class="text-gray-300 text-sm">Sign in to your account to continue</p>
                    </div>

                    <div class="mx-6 mb-6 p-4 bg-blue-500/20 border border-blue-400/30 rounded-xl">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-blue-300 text-sm flex items-center">
                                <i class="fas fa-key mr-2"></i>Demo Credentials
                            </h4>
                            <span class="bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-medium">TEST</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div>
                                <span class="text-blue-200">Username:</span>
                                <div class="bg-blue-500/30 text-blue-100 px-2 py-1 rounded mt-1 font-mono">user</div>
                            </div>
                            <div>
                                <span class="text-blue-200">Password:</span>
                                <div class="bg-blue-500/30 text-blue-100 px-2 py-1 rounded mt-1 font-mono">123456</div>
                            </div>
                        </div>
                    </div>

                    <form @submit.prevent="handleLogin" class="px-8 pb-8 space-y-5">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-white">Username</label>
                            <div class="relative">
                                <i class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input
                                    v-model="loginForm.username"
                                    type="text"
                                    required
                                    class="glass-input w-full rounded-xl px-12 py-4 text-white placeholder-gray-400 focus:outline-none"
                                    placeholder="Enter your username"
                                >
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2 text-white">Password</label>
                            <div class="relative">
                                <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input
                                    v-model="loginForm.password"
                                    type="password"
                                    required
                                    class="glass-input w-full rounded-xl px-12 py-4 text-white placeholder-gray-400 focus:outline-none"
                                    placeholder="Enter your password"
                                >
                            </div>
                        </div>

                        <button
                            type="submit"
                            :disabled="loading"
                            class="btn-primary w-full text-white py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <i class="fas fa-spinner fa-spin mr-2" v-if="loading"></i>
                            {{ loading ? 'Signing in...' : 'Sign In' }}
                        </button>

                        <div class="h-px bg-gradient-to-r from-transparent via-gray-500 to-transparent my-6"></div>

                        <div class="text-center">
                            <p class="text-gray-400 text-sm">
                                Don't have an account?
                                <button type="button" @click="closeLoginAndOpenRegister" class="text-blue-400 hover:text-blue-300 font-medium transition-colors">
                                    Sign up here
                                </button>
                            </p>
                        </div>
                    </form>

                    <div v-if="error" class="mx-6 mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-200 text-sm">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-circle mr-3"></i>
                            <span>{{ error }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="showRegister" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                <div class="glass-card rounded-3xl max-w-md w-full mx-auto">
                    <div class="p-8 pb-6">
                        <div class="flex justify-between items-center mb-2">
                            <h2 class="text-2xl font-bold font-oswald text-white">Join Our Community</h2>
                            <button @click="closeRegister" class="text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-white/10">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <p class="text-gray-300 text-sm">Demo Mode - Registration disabled</p>
                    </div>

                    <div class="mx-6 mb-6 p-4 bg-yellow-500/20 border border-yellow-500/30 rounded-xl">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-yellow-300 mt-0.5 mr-3"></i>
                            <div>
                                <p class="text-yellow-200 text-sm font-medium mb-1">Demo Mode Active</p>
                                <p class="text-yellow-200/80 text-xs">Registration is disabled in this demo. Use the credentials below to explore the platform.</p>
                            </div>
                        </div>
                    </div>

                    <div class="px-8 pb-8">
                        <button @click="closeRegisterAndOpenLogin" class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl">
                            <i class="fas fa-sign-in-alt mr-2"></i>Use Demo Credentials
                        </button>

                        <div class="h-px bg-gradient-to-r from-transparent via-gray-500 to-transparent my-6"></div>

                        <div class="text-center">
                            <p class="text-gray-400 text-sm">
                                Already have an account?
                                <button type="button" @click="closeRegisterAndOpenLogin" class="text-blue-400 hover:text-blue-300 font-medium transition-colors">
                                    Sign in here
                                </button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="showCreatePost || showEditPost" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                <div class="glass-card rounded-3xl max-w-2xl w-full mx-auto max-h-[90vh] overflow-y-auto">
                    <div class="p-8 pb-6">
                        <div class="flex justify-between items-center mb-2">
                            <h2 class="text-2xl font-bold font-oswald text-white">
                                {{ showEditPost ? 'Edit Post' : 'Create New Post' }}
                            </h2>
                            <button @click="closePostModal" class="text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-white/10">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <p class="text-gray-300 text-sm">
                            {{ showEditPost ? 'Update your post content' : 'Share your thoughts with the community' }}
                        </p>
                    </div>

                    <form @submit.prevent="showEditPost ? updatePost() : createPost()" class="px-8 pb-8 space-y-5">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-white">Title</label>
                            <input
                                v-model="postForm.title"
                                type="text"
                                required
                                maxlength="100"
                                class="glass-input w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none"
                                placeholder="Enter post title"
                            >
                            <div class="text-right text-xs text-gray-400 mt-1">
                                {{ postForm.title.length }}/100
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2 text-white">Excerpt</label>
                            <textarea
                                v-model="postForm.excerpt"
                                required
                                rows="2"
                                maxlength="200"
                                class="glass-input w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none resize-none"
                                placeholder="Brief description of your post"
                            ></textarea>
                            <div class="text-right text-xs text-gray-400 mt-1">
                                {{ postForm.excerpt.length }}/200
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2 text-white">Content</label>
                            <textarea
                                v-model="postForm.content"
                                required
                                rows="6"
                                class="glass-input w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none resize-none"
                                placeholder="Write your post content here..."
                            ></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2 text-white">Tags (Press Enter to add)</label>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span
                                    v-for="(tag, index) in postForm.tags"
                                    :key="tag"
                                    class="tag text-white flex items-center cursor-pointer"
                                    @click="removeTag(index)"
                                >
                                    #{{ tag }}
                                    <i class="fas fa-times ml-2 text-xs opacity-70 hover:opacity-100 transition-opacity"></i>
                                </span>
                            </div>
                            <input
                                @keydown.enter.prevent="addTag"
                                type="text"
                                class="glass-input w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none"
                                placeholder="Add a tag (e.g., technology)"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2 text-white">Status</label>
                            <select v-model="postForm.status" class="glass-input w-full rounded-xl px-4 py-3 text-white focus:outline-none">
                                <option value="Draft" class="bg-gray-800 text-white">Draft</option>
                                <option value="Published" class="bg-gray-800 text-white">Published</option>
                                <option value="Review" class="bg-gray-800 text-white">Review</option>
                                <option value="Archived" class="bg-gray-800 text-white">Archived</option>
                            </select>
                        </div>


                        <button
                            type="submit"
                            :disabled="loading"
                            class="btn-primary w-full text-white py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <i class="fas fa-spinner fa-spin mr-2" v-if="loading"></i>
                            {{ loading ? (showEditPost ? 'Updating...' : 'Creating...') : (showEditPost ? 'Update Post' : 'Publish Post') }}
                        </button>
                    </form>
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="showDeleteDialog" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                <div class="glass-card rounded-3xl max-w-sm w-full mx-auto transform transition-all duration-300 scale-100 opacity-100">
                    <div class="p-8 text-center">
                        <i class="fas fa-exclamation-triangle text-red-500 text-6xl mb-4 animate-bounce"></i>
                        <h2 class="text-2xl font-bold font-oswald text-white mb-2">Confirm Deletion</h2>
                        <p class="text-gray-300 mb-6">
                            Are you sure you want to delete <span class="font-semibold text-red-400">{{ itemToDelete.type }}</span>: **{{ itemToDelete.name }}**?
                        </p>
                        <p class="text-red-400 text-sm italic mb-8">This action is irreversible.</p>

                        <div class="flex justify-center space-x-4">
                            <button @click="closeDeleteDialog" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                                <i class="fas fa-times-circle mr-2"></i>Cancel
                            </button>
                            <button @click="confirmDeletion" :disabled="loading" class="btn-danger text-white px-6 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-trash-alt mr-2" v-if="!loading"></i>
                                <i class="fas fa-spinner fa-spin mr-2" v-else></i>
                                {{ loading ? 'Deleting...' : 'Confirm Delete' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-10">
            <div class="lg:col-span-2">
                <h2 class="text-4xl font-bold font-oswald text-white mb-8">
                    <i class="fas fa-newspaper mr-3 text-blue-400"></i>
                    Post Feed <span v-if="user" class="text-sm font-poppins text-gray-400 font-normal">({{ filteredPosts.length }} Results)</span>
                </h2>

                <div v-if="!user" class="hero-section mt-10 mb-16">
                    <h3 class="hero-title font-oswald text-white">
                        <span class="gradient-text">Digital Plataform</span> for Personal Notes Blogs
                    </h3>
                    <p class="text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
                        This is a demonstration application of a modern CMS built with Flask, Vue 3, and Tailwind CSS. Log in with the default credentials to access the full dashboard, create, edit, and manage your posts.
                    </p>
                    <div class="flex justify-center space-x-4">
                        <button @click="showLogin = true" class="btn-primary text-white px-8 py-4 rounded-xl font-semibold text-lg transform hover:scale-105">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login to Dashboard
                        </button>
                        <button @click="scrollToFeed" class="bg-gray-700 hover:bg-gray-600 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-colors">
                            <i class="fas fa-eye mr-2"></i>View Public Feed
                        </button>
                    </div>
                </div>

                <div v-else-if="filteredPosts.length === 0" class="glass-card p-10 rounded-xl text-center mt-10">
                    <i class="fas fa-search-minus text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-oswald text-white mb-2">No Posts Found</h3>
                    <p class="text-gray-300">Your search criteria did not match any posts. Try a different query or create a new post.</p>
                </div>
                

                <transition-group name="slide-fade" tag="div" class="space-y-8" ref="postFeed">
                    <div v-for="post in filteredPosts" :key="post.id" class="glass-card p-6 rounded-xl post-card hover-lift">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-2xl font-bold font-oswald text-white hover:text-blue-400 transition-colors cursor-pointer">
                                <span v-html="highlight(post.title)"></span>
                            </h3>
                            <span :class="[
                                'text-xs font-medium px-3 py-1 rounded-full',
                                post.status === 'Published' ? 'bg-green-500/30 text-green-300' :
                                post.status === 'Draft' ? 'bg-yellow-500/30 text-yellow-300' :
                                post.status === 'Review' ? 'bg-blue-500/30 text-blue-300' :
                                'bg-red-500/30 text-red-300' /* Archived */
                            ]">
                                {{ post.status }}
                            </span>
                        </div>

                        <p class="text-gray-300 text-sm mb-4">
                            <i class="fas fa-calendar-alt mr-2 text-blue-400"></i>
                            {{ post.date }} by <span class="font-medium text-white">{{ post.author }}</span>
                        </p>

                        <div class="post-content mb-4 text-gray-200">
                            <p class="mb-4 text-gray-300 italic"><span v-html="highlight(post.excerpt)"></span></p>
                            <p class="text-white text-sm leading-relaxed" v-html="highlight(post.content)"></p>
                        </div>
                        
                        <div class="tag-cloud mb-4">
                            <span v-for="tag in post.tags" :key="tag" @click="searchQuery = tag" class="tag text-white cursor-pointer hover:neon-glow">
                                #{{ tag }}
                            </span>
                        </div>
                        
                        <div v-if="user" class="flex space-x-4 pt-4 border-t border-white/10 mt-4">
                            <button @click="startEditPost(post)" class="btn-primary text-white px-4 py-2 rounded-lg text-sm transition-all duration-300 transform hover:scale-105">
                                <i class="fas fa-edit mr-2"></i>Edit
                            </button>
                            <button @click="startDeletion(post.id, 'Post', post.title)" class="btn-danger text-white px-4 py-2 rounded-lg text-sm transition-all duration-300 transform hover:scale-105">
                                <i class="fas fa-trash-alt mr-2"></i>Delete
                            </button>
                            <a href="#" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors flex items-center">
                                <i class="fas fa-eye mr-2"></i>Preview
                            </a>
                        </div>
                    </div>
                </transition-group>
            </div>

            <div class="lg:col-span-1 space-y-8">
                <div v-if="user" class="glass-card p-6 rounded-xl hover-lift">
                    <h3 class="text-xl font-bold font-oswald text-white mb-4 flex items-center">
                        <i class="fas fa-tachometer-alt mr-2 text-green-400"></i>
                        Dashboard Metrics
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-gray-300 border-b border-white/10 pb-2">
                            <span class="font-medium">Total Posts:</span>
                            <span class="font-oswald text-lg text-white">{{ posts.length }}</span>
                        </div>
                        <div class="flex justify-between items-center text-gray-300 border-b border-white/10 pb-2">
                            <span class="font-medium">Published:</span>
                            <span class="font-oswald text-lg text-green-400">{{ posts.filter(p => p.status === 'Published').length }}</span>
                        </div>
                        <div class="flex justify-between items-center text-gray-300">
                            <span class="font-medium">Drafts:</span>
                            <span class="font-oswald text-lg text-yellow-400">{{ posts.filter(p => p.status === 'Draft').length }}</span>
                        </div>
                    </div>
                    <button class="w-full mt-6 btn-secondary text-white py-3 rounded-lg font-medium">
                        <i class="fas fa-cogs mr-2"></i>Go to Admin Panel
                    </button>
                </div>
                
                <div class="glass-card p-6 rounded-xl hover-lift">
                    <h3 class="text-xl font-bold font-oswald text-white mb-4 flex items-center">
                        <i class="fas fa-tags mr-2 text-purple-400"></i>
                        Tag Cloud
                    </h3>
                    <div class="tag-cloud">
                        <span v-for="tag in allUniqueTags" :key="tag" @click="searchQuery = tag" class="tag text-white cursor-pointer hover:neon-glow">
                            #{{ tag }}
                        </span>
                        <span v-if="allUniqueTags.length === 0" class="text-gray-400 text-sm">No tags available. Create a post to add tags.</span>
                    </div>
                </div>

                <div v-if="user" class="glass-card p-6 rounded-xl">
                    <h3 class="text-xl font-bold font-oswald text-white mb-4 flex items-center">
                        <i class="fas fa-bolt mr-2 text-orange-400"></i>
                        Quick Actions
                    </h3>
                    <div class="space-y-4">
                        <button @click="showCreatePost = true" class="w-full btn-primary text-white py-3 rounded-lg font-medium">
                            <i class="fas fa-plus mr-2"></i>Create New Post
                        </button>
                        <button @click="logout" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;

        // Custom directive for clicking outside an element
        const clickOutside = {
            beforeMount: (el, binding) => {
                el.clickOutsideEvent = (event) => {
                    if (!(el === event.target || el.contains(event.target))) {
                        binding.value(event);
                    }
                };
                document.addEventListener("click", el.clickOutsideEvent);
            },
            unmounted: (el) => {
                document.removeEventListener("click", el.clickOutsideEvent);
            },
        };

        createApp({
            directives: {
                'click-outside': clickOutside
            },
            setup() {
                const user = ref(null);
                const posts = ref([]);
                const loading = ref(false);
                const error = ref(null);
                const notifications = ref([]);
                
                // Modals & Forms
                const showLogin = ref(false);
                const showRegister = ref(false);
                const showCreatePost = ref(false);
                const showEditPost = ref(false);
                const showDeleteDialog = ref(false);
                const itemToDelete = ref({ id: null, type: '', name: '' });
                const showScrollTop = ref(false);
                const isDarkMode = ref(true); // Default to dark mode
                const isMobileSearchVisible = ref(false);
                
                // For scrolling to the feed area
                const postFeed = ref(null);

                // Search State
                const searchQuery = ref('');
                const showSuggestions = ref(false); // New state for suggestions dropdown

                // Form States
                const loginForm = ref({ username: '', password: '' });
                const postForm = ref({
                    id: null,
                    title: '',
                    excerpt: '',
                    content: '',
                    tags: [],
                    status: 'Draft',
                    author: '',
                    date: '',
                });

                // --- UTILITIES ---

                const addNotification = (message, type = 'info', duration = 3000) => {
                    const id = Date.now();
                    notifications.value.push({ id, message, type });
                    setTimeout(() => {
                        removeNotification(id);
                    }, duration);
                };

                const removeNotification = (id) => {
                    notifications.value = notifications.value.filter(n => n.id !== id);
                };

                const scrollToTop = () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };
                
                // New function to scroll to the post feed section (for non-logged-in users)
                const scrollToFeed = () => {
                    const mainContent = document.querySelector('main');
                    if (mainContent) {
                        window.scrollTo({ top: mainContent.offsetTop, behavior: 'smooth' });
                    } else {
                        // Fallback to top if main is not found (shouldn't happen)
                        scrollToTop();
                    }
                };

                const handleScroll = () => {
                    showScrollTop.value = window.scrollY > 300;
                };

                const toggleTheme = () => {
                    isDarkMode.value = !isDarkMode.value;
                    document.body.classList.toggle('dark-mode', isDarkMode.value);
                    localStorage.setItem('theme', isDarkMode.value ? 'dark' : 'light');
                };

                const loadTheme = () => {
                    const storedTheme = localStorage.getItem('theme');
                    if (storedTheme) {
                        isDarkMode.value = storedTheme === 'dark';
                    }
                    document.body.classList.toggle('dark-mode', isDarkMode.value);
                    document.body.classList.add('gradient-bg'); // Ensure the base gradient is always there
                };


                // --- API SIMULATIONS ---

                const mockUsers = [
                    { id: 1, username: 'user', password: '123456', full_name: 'John Doe (Demo User)' },
                ];

                const mockPosts = ref([

                    { id: 1, title: 'Personal Notes Platform', excerpt: 'A dedicated area for personal notes and reminders, describing the CMS application’s core features.', content: 'This platform allows you to create, edit, and manage your content efficiently. Posts can be categorized using tags, and their visibility can be controlled using the status (Draft, Published, Review). Use this space to jot down private ideas or track development notes.', tags: ['Notes', 'Personal', 'CMS'], status: 'Published', author: 'Jane Doe', date: '2025-11-15 09:00' }, 
                    
                    { id: 2, title: 'Unveiling the Future of Web Dev', excerpt: 'A deep dive into Vue 3, Tailwind CSS, and Flask.', content: 'The convergence of modern frontend frameworks like Vue.js with utility-first CSS frameworks such as Tailwind CSS offers unparalleled development speed and flexibility. When paired with a robust backend like Flask, you get a scalable and maintainable CMS.', tags: ['VueJS', 'TailwindCSS', 'Flask', 'Tech'], status: 'Published', author: 'Jane Doe', date: '2025-11-14 10:00' },
                    
                    { id: 3, title: 'Glassmorphism Design Trends', excerpt: 'Exploring the elegant aesthetic of blurred backgrounds and frosted glass effects.', content: 'Glassmorphism, characterized by transparent, blurred backgrounds, is the defining visual trend of the moment. It adds depth and a modern, airy feel to interfaces. We implemented it using Tailwind\'s `backdrop-filter` utility for a premium look.', tags: ['Design', 'CSS', 'Glassmorphism'], status: 'Published', author: 'Jane Doe', date: '2025-11-13 14:30' },
                    
                    { id: 4, title: 'Draft: CMS Performance Optimization', excerpt: 'Initial ideas for improving loading times and reducing bundle sizes.', content: 'We need to investigate server-side rendering (SSR) options or static site generation (SSG) to improve the initial load performance. Optimizing the API endpoints is also crucial for faster data fetching.', tags: ['Performance', 'Backend'], status: 'Published', author: 'Jane Doe', date: '2025-11-12 09:15' },
                    
                    { id: 5, title: 'Python and Async IO', excerpt: 'Understanding the benefits of asynchronous programming in Flask.', content: 'Async IO in Python allows web applications to handle many concurrent connections, significantly improving throughput for I/O-bound tasks. This is vital for a high-traffic CMS platform.', tags: ['Python', 'Backend', 'Tech'], status: 'Published', author: 'Jane Doe', date: '2025-11-10 18:45' },
                ]);
                
                posts.value = [...mockPosts.value];


                // --- AUTH LOGIC ---

                const handleLogin = async () => {
                    loading.value = true;
                    error.value = null;

                    await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate API delay

                    const foundUser = mockUsers.find(
                        u => u.username === loginForm.value.username && u.password === loginForm.value.password
                    );

                    if (foundUser) {
                        user.value = foundUser;
                        // In a real app, save token/session here
                        localStorage.setItem('user', JSON.stringify(foundUser));
                        closeLogin();
                        addNotification(`Welcome back, ${foundUser.full_name.split(' ')[0]}!`, 'success');
                        fetchPosts(); // Ensure posts are fetched/refreshed
                    } else {
                        error.value = 'Invalid username or password.';
                        addNotification('Login failed: Invalid credentials.', 'error');
                    }

                    loading.value = false;
                };

                const logout = () => {
                    user.value = null;
                    // In a real app, clear token/session
                    localStorage.removeItem('user');
                    loginForm.value = { username: '', password: '' };
                    addNotification('You have been logged out successfully.', 'info');
                };

                const checkAuth = () => {
                    const storedUser = localStorage.getItem('user');
                    if (storedUser) {
                        user.value = JSON.parse(storedUser);
                    }
                };
                
                // --- POSTS LOGIC ---
                
                const fetchPosts = () => {
                    loading.value = true;
                    // Simulate fetching posts (already stored in posts.value from mock data)
                    setTimeout(() => {
                        posts.value.sort((a, b) => new Date(b.date) - new Date(a.date));
                        loading.value = false;
                    }, 500);
                };

                const createPost = () => {
                    loading.value = true;
                    setTimeout(() => {
                        // Calcula el ID más alto y añade 1, si no hay posts, usa 1
                        const newId = posts.value.length > 0 ? Math.max(...posts.value.map(p => p.id)) + 1 : 1;
                        const now = new Date();
                        const dateString = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                        
                        const newPost = {
                            id: newId,
                            ...postForm.value,
                            author: user.value.full_name.split(' ')[0], // Use first name for author
                            date: dateString,
                        };
                        
                        posts.value.unshift(newPost); // Add to the beginning
                        closePostModal();
                        addNotification('Post created successfully!', 'success');
                        loading.value = false;
                    }, 1000);
                };

                const startEditPost = (post) => {
                    postForm.value = { ...post, tags: [...post.tags] }; // Deep copy tags
                    showEditPost.value = true;
                };

                const updatePost = () => {
                    loading.value = true;
                    setTimeout(() => {
                        const index = posts.value.findIndex(p => p.id === postForm.value.id);
                        if (index !== -1) {
                            // Reemplaza el objeto en el array, manteniendo la clave reactiva
                            posts.value[index] = { ...postForm.value, date: posts.value[index].date }; 
                            // Opcional: forzar la reactividad del array si es necesario, aunque Vue 3 es mejor en esto
                            posts.value = [...posts.value];
                            addNotification(`Post: "${postForm.value.title}" updated!`, 'success');
                        }
                        closePostModal();
                        loading.value = false;
                    }, 1000);
                };
                
                // Deletion Handlers
                const startDeletion = (id, type, name) => {
                    itemToDelete.value = { id, type, name };
                    showDeleteDialog.value = true;
                };

                const closeDeleteDialog = () => {
                    showDeleteDialog.value = false;
                    itemToDelete.value = { id: null, type: '', name: '' };
                };

                const confirmDeletion = () => {
                    if (itemToDelete.value.type === 'Post') {
                        deletePost(itemToDelete.value.id, itemToDelete.value.name);
                    }
                    closeDeleteDialog();
                };

                const deletePost = (id, title) => {
                    loading.value = true;
                    setTimeout(() => {
                        // CORRECCIÓN IMPLEMENTADA: Filtrar el array y REASIGNAR completamente para asegurar la reactividad
                        posts.value = posts.value.filter(p => p.id !== id);
                        
                        addNotification(`Post: "${title}" deleted permanently.`, 'error');
                        loading.value = false;
                    }, 800);
                };
                
                // Tags Logic
                const addTag = (event) => {
                    const tag = event.target.value.trim().toLowerCase();
                    if (tag && !postForm.value.tags.includes(tag) && postForm.value.tags.length < 5) {
                        postForm.value.tags.push(tag);
                        event.target.value = '';
                    } else if (postForm.value.tags.length >= 5) {
                        addNotification('Maximum 5 tags allowed.', 'info', 2000);
                    }
                };

                const removeTag = (index) => {
                    postForm.value.tags.splice(index, 1);
                };
                
                // --- MODAL HANDLERS ---
                
                const closeLogin = () => {
                    showLogin.value = false;
                    error.value = null;
                };
                
                const closeRegister = () => {
                    showRegister.value = false;
                };

                const closeLoginAndOpenRegister = () => {
                    closeLogin();
                    nextTick(() => { showRegister.value = true; });
                };

                const closeRegisterAndOpenLogin = () => {
                    closeRegister();
                    nextTick(() => { showLogin.value = true; });
                };

                const resetPostForm = () => {
                    postForm.value = {
                        id: null,
                        title: '',
                        excerpt: '',
                        content: '',
                        tags: [],
                        status: 'Draft',
                        author: '',
                        date: '',
                    };
                };

                const closePostModal = () => {
                    showCreatePost.value = false;
                    showEditPost.value = false;
                    resetPostForm();
                };
                
                // --- SEARCH AND FILTERING (CORE NEW FUNCTIONALITY) ---
                
                const filterLogic = (post, query) => {
                    const postTitle = post.title.toLowerCase();
                    const postExcerpt = post.excerpt.toLowerCase();
                    const postContent = post.content.toLowerCase();
                    const tagMatch = post.tags.some(tag => tag.toLowerCase().includes(query));

                    return postTitle.includes(query) || 
                           postExcerpt.includes(query) || 
                           postContent.includes(query) || 
                           tagMatch;
                }
                
                const filteredPosts = computed(() => {
                    // Cuando no está logueado, solo mostrar posts 'Published'.
                    let basePosts = posts.value;
                    if (!user.value) {
                        basePosts = posts.value.filter(p => p.status === 'Published');
                    }

                    if (!searchQuery.value) {
                        return basePosts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    }

                    const query = searchQuery.value.toLowerCase().trim();

                    return basePosts.filter(post => filterLogic(post, query))
                                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                });
                
                // New computed property for autocomplete suggestions
                const postSuggestions = computed(() => {
                    const query = searchQuery.value.toLowerCase().trim();
                    if (!query || query.length < 2) {
                        return [];
                    }
                    
                    // Sugerencias solo vienen de posts visibles al usuario (Published si no está logueado)
                    let basePosts = posts.value;
                    if (!user.value) {
                        basePosts = posts.value.filter(p => p.status === 'Published');
                    }

                    // Get unique matching posts (limit to top 5)
                    const matches = basePosts.filter(post => filterLogic(post, query))
                                                .slice(0, 5);

                    return matches;
                });
                
                // New method to handle selection from suggestions
                const selectSuggestion = (post) => {
                    searchQuery.value = post.title;
                    showSuggestions.value = false;
                    // The feed is automatically filtered by the computed property 'filteredPosts'
                };
                
                // Highlight function to wrap matched text with a span
                const highlight = (text) => {
                    if (!searchQuery.value) {
                        return text;
                    }

                    const query = searchQuery.value.trim();
                    if (!query) {
                        return text;
                    }

                    // Regex to find the query, case-insensitive, and globally
                    const regex = new RegExp(`(${query})`, 'gi');
                    
                    // Replace matches with the highlighted span
                    return text.replace(regex, '<span class="search-highlight">$1</span>');
                };
                
                // --- SIDEBAR COMPUTED ---
                
                const allUniqueTags = computed(() => {
                    const tagSet = new Set();
                    
                    // Solo usar posts visibles al usuario actual
                    let visiblePosts = posts.value;
                    if (!user.value) {
                        visiblePosts = posts.value.filter(p => p.status === 'Published');
                    }
                    
                    visiblePosts.forEach(post => {
                        post.tags.forEach(tag => tagSet.add(tag));
                    });
                    return Array.from(tagSet).sort((a, b) => b.length - a.length); // Longer tags first for better display
                });

                // --- LIFECYCLE HOOKS ---
                
                onMounted(() => {
                    loadTheme(); // Load theme preference
                    checkAuth();
                    fetchPosts();
                    window.addEventListener('scroll', handleScroll);
                });
                
                // Cleanup on unmount (optional, but good practice)
                Vue.onUnmounted(() => {
                    window.removeEventListener('scroll', handleScroll);
                });

                return {
                    user,
                    posts,
                    loading,
                    error,
                    showLogin,
                    showRegister,
                    showCreatePost,
                    showEditPost,
                    showDeleteDialog,
                    itemToDelete,
                    loginForm,
                    postForm,
                    notifications,
                    searchQuery,
                    showSuggestions,
                    postSuggestions,
                    showScrollTop,
                    isDarkMode,
                    isMobileSearchVisible,

                    handleLogin,
                    logout,
                    createPost,
                    startEditPost,
                    updatePost,
                    startDeletion,
                    confirmDeletion,
                    closeLogin,
                    closeRegister,
                    closeLoginAndOpenRegister,
                    closeRegisterAndOpenLogin,
                    closePostModal,
                    addTag,
                    removeTag,
                    removeNotification,
                    scrollToTop,
                    scrollToFeed, // Expose new scroll function
                    toggleTheme,
                    selectSuggestion,
                    
                    filteredPosts,
                    highlight,
                    allUniqueTags
                };
            }
        }).mount("#app");
    </script>
</body>
</html>